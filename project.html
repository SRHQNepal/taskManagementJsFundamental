<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <script src="https://cdn.tailwindcss.com"></script>
    <title>Project</title>
  </head>
  <body>
    <nav
      class="relative w-full flex flex-row items-center justify-between py-4 bg-gray-100 text-gray-500 hover:text-gray-700 focus:text-gray-700 shadow-lg navbar navbar-expand-lg navbar-light"
    >
      <div
        class="container-fluid w-full flex flex-wrap items-center justify-center px-6"
      >
        <div class="flex flex-row items-center justify-center mt-3">
          Online Task Management System
        </div>
      </div>
      <div class="mr-10">
        <!-- Creating profile avatar and logout button -->
        <div class="flex flex-col">
          <div class="flex flex-row">
            <a>admin</a>
          </div>
          <a href="index.html">Logout</a>
        </div>
      </div>
    </nav>

    <div>
      <!-- Creating input to create the project -->
      <div class="flex flex-row items-center justify-center mt-10">
        <div class="flex flex-row p-2  w-1/2">
            <input
              id="taskName"
              type="text"
              class="form-control block w-full px-4 py-2 text-xl font-normal text-gray-700 bg-white bg-clip-padding shadow-md rounded transition ease-in-out m-0 focus:text-gray-700 outline-none"
              placeholder="Type to create task"
            />
            </div>

    </div>
    <div class="flex flex-row items-center justify-center mt-10">
      <table
        id="tasksTable"
        class="table-auto shadow-md w-11/12 p-5"
      ></table>
    </div>

    <script>

        var projects = [
        {
          id: 1,
          name: "Project 1",
          description: "This is project 1",
          tasks: [
            {
              name: "Task 1",
              description: "This is task 1",
              status: "incomplete",
            },
            {
              name: "Task 2",
              description: "This is task 2",
              status: "incomplete",
            },
            {
              name: "Task 3",
              description: "This is task 3",
              status: "incomplete",
            },
          ],
          overallStatus: "incomplete",
        },
        {
          id: 2,
          name: "Project 2",
          description: "This is project 2",
          tasks: [
            {
              name: "Task 1",
              description: "This is task 1",
              status: "incomplete",
            },
            {
              name: "Task 2",
              description: "This is task 2",
              status: "incomplete",
            },
            {
              name: "Task 3",
              description: "This is task 3",
              status: "incomplete",
            },
          ],
          overallStatus: "incomplete",
        },
        {
          id: 3,
          name: "Project 3",
          description: "This is project 3",
          tasks: [
            {
              name: "Task 1",
              description: "This is task 1",
              status: "incomplete",
            },
            {
              name: "Task 2",
              description: "This is task 2",
              status: "incomplete",
            },
            {
              name: "Task 3",
              description: "This is task 3",
              status: "incomplete",
            },
          ],
          overallStatus: "incomplete",
        },
      ];

      var users = [
        {
          id: 1,
          name: "admin",
        },
        {
          id: 2,
          name: "user1",
        },
        {
          id: 3,
          name: "user2",
        },
      ];
      var tasks = [];
     // saving to local storage
      function saveToLocalStorage() {
        localStorage.setItem("projects", JSON.stringify(projects));
        localStorage.setItem("users", JSON.stringify(users));
      }
       
      // getting project id from url
      function getUrlVars() {
    var vars = {};
    var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
                vars[key] = value;
            });
            return vars;
        }

    var projectId = getUrlVars()["projectId"];

        document.addEventListener("DOMContentLoaded", function() {
        project = projects.find(p => p.id == projectId);;
        tasks = project.tasks;
            // creating table for tasks
    fillTasksTable();
        document.title = project.name + ": Online Task Management System";
    });

    // focusing on the text bar for adding task
    document.getElementById("taskName").focus();



     function fillElementsOfTable(itemsWhereToAppend, whatToAppend){

        // Creating headers for the table
        var taskRow = document.createElement("tr");
        var taskId = document.createElement("th");
        var taskName = document.createElement("th");
        var taskDescription = document.createElement("th");
        var taskOverallStatus = document.createElement("th");
        var taskAssignee = document.createElement("th");
        // create a dropdown for assignee
        var assigneeDropdown = document.createElement("select");
        assigneeDropdown.innerHTML = "<option value=''>Please Select</option>";
        // create options for the dropdown
       


        taskId.innerHTML = whatToAppend.firstItem;
        taskName.innerHTML = whatToAppend.secondItem;
        taskDescription.innerHTML = whatToAppend.thirdItem;
        taskOverallStatus.innerHTML = whatToAppend.fourthItem;
        // print the type of tbody or thead
        console.log(itemsWhereToAppend.tagName);
        if (itemsWhereToAppend.tagName == "THEAD") {
            taskAssignee.innerHTML = whatToAppend.fifthItem;
        } else {
            taskAssignee.appendChild(assigneeDropdown);
             assigneeDropdown.setAttribute("id", "assigneeDropdown");
        assigneeDropdown.setAttribute("class", "form-control");
        assigneeDropdown.setAttribute("name", "assigneeDropdown");
        assigneeDropdown.setAttribute("onchange", "changeAssignee(this)");
        assigneeDropdown.setAttribute("value", whatToAppend.fifthItem);
        // create options for the dropdown
        
 

        for (var i = 0; i < users.length; i++) {
            var option = document.createElement("option");
            
            // setting the deafult value of the dropdown to please select if the task doesnt have an assignee
            option.setAttribute("value", users[i].id);
            option.innerHTML = users[i].name;
            assigneeDropdown.appendChild(option);

            // if the whatToAppend.fifthItem is not null then set the value of the dropdown to the assignee of the task
    
        }

        // setting default value of the dropdown to please select
   
        }
        
            

        taskRow.appendChild(taskId);
        taskRow.appendChild(taskName);
        taskRow.appendChild(taskDescription);
        taskRow.appendChild(taskOverallStatus);
        taskRow.appendChild(taskAssignee);

        itemsWhereToAppend.appendChild(taskRow);
      }

      function fillTasksTable() {

        var tasksTable = document.getElementById("tasksTable");
        var taskTableHead = document.createElement("thead");
        var taskTableBody = document.createElement("tbody");

        // Clear the table first
        tasksTable.innerHTML = "";


        contentsToAppend = {
          firstItem: "ID",
          secondItem: "NAME",
          thirdItem: "DESCRIPTION",
          fourthItem:  "STATUS",
          fifthItem: "ASSIGNEE",
        }
        fillElementsOfTable(taskTableHead, contentsToAppend);
        console.log(tasks);
        tasks.forEach((task) => {
            console.log(task);
          contentsToAppend = {
            firstItem: task.id ? task.id : "",
            secondItem: task.name,
            thirdItem: task.description,
            fourthItem: task.status ? task.status : "",
            fifthItem: task.assignee ? task.assignee : "",
          }
          fillElementsOfTable(taskTableBody, contentsToAppend);
        });
        tasksTable.appendChild(taskTableHead);
        tasksTable.appendChild(taskTableBody);
        // loadEventHandlers();
      }


    </script>
  </body>
</html>
